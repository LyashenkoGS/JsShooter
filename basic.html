<!doctype html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>


    <link rel="stylesheet" type="text/css" href="./styles/main.css">


    <title>JsShooter</title>


</head>
<body>

<div id="info">
<ul id="scores">
    <li>hit:<span id="hit"></span></li>
    <li>miss:<span id="miss"></span></li>
</ul>
<input id="photo" type="file"></br>
<button id="changePhoto" style="float: right"> changePhoto</button>

</div>

<div id="canvas" style="height: 100%">

    <div id="target">
        <img id="targetImg" src="images/simple_target.png">

    </div>




    <div id="gun" style="position: fixed;
bottom: -15px;
left: 50%;
transform: translate(-50%, 0px);"><img id="gunImg" src="./images/gun.png"></div>
</div>

<script type="text/javascript">
    $(document).ready(function () {



       //trying to use OOP
        //constructor for targets
        function Target(){
            var targetVerticalSpeed = 5
            var targetHorizontalSpeed = 5
            var img = document.createElement("img")
            img.src = "images/simple_target.png"
            var target=document.createElement("div")
            target.className = "target"
            target.style.left ="50px"
            target.style.top ="50px"
            var canvas=document.getElementById("canvas")
            canvas.appendChild(target)
                target.appendChild(img)
             this.target=target

            this.move=function(){
            this.target.style.top = (parseInt(this.target.style.top) + targetVerticalSpeed) + "px"
       this.target.style.left = (parseInt(this.target.style.left) + targetHorizontalSpeed) + "px"

            }



        }



var myTar = new Target()
       console.log( myTar.move())
        for (i = 0; i < 50; i++) {
       myTar.move()
        }


// below is old work functional code
        var target = document.getElementById('target')
        target.style.top = "100px"
        target.style.left = "100px"

        var targetVerticalSpeed = 5
        var targetHorizontalSpeed = 5
        var move = false
        var timeout
        var browserWidth = window.innerWidth
        var browserHeight = window.innerHeight
        var numOfHitts = 0
        var numOfMisses = 0



        function moveTarget(event) {
                if (move) {
                    targetCollision()
                    target.style.top = (parseInt(target.style.top) + targetVerticalSpeed) + "px"
                    target.style.left = (parseInt(target.style.left) + targetHorizontalSpeed) + "px"

                }
            }

            function targetCollision() {
                //vertical collision
                if (parseInt(target.style.top) + target.offsetHeight > browserHeight || parseInt(target.style.top) < 0)
                    targetVerticalSpeed = -targetVerticalSpeed
                //horizontal collision
                if (parseInt(target.style.left) + target.offsetWidth > browserWidth || parseInt(target.style.left) < 0)
                    targetHorizontalSpeed = -targetHorizontalSpeed
            }

            document.addEventListener("keydown", stopStartTarget)
            function stopStartTarget(event) {
                if (event.keyCode == 80 && move == false) {
                    move = true
                    moveTarget()
                }
                else {
                    move = false
                    clearInterval(timeout)
                }
            }


            var changePhotoButton = document.getElementById('changePhoto')
            changePhotoButton.addEventListener("click", changePhoto)
            function changePhoto() {
                var targetImage = document.getElementById('targetImg')
                var photo = document.getElementById("photo")
                var photoName = photo.value
                var photoSliced = photoName.slice(12)
                targetImage.src = photoSliced
            }

            function shot() {
                var audio = new Audio('./sounds/gun-gunshot-01.mp3')
                audio.play();
                var gun = document.getElementById("gun")
                gun.style.bottom = parseInt(gun.style.bottom) + 20 + "px"
                console.log(gun.style.bottom)
                setTimeout(function () {
                    gun.style.bottom = parseInt(gun.style.bottom) - 20 + "px"
                }, 100);
            }

            var target = document.getElementById('target')
            document.addEventListener("click", hit)

            function hit(event) {
                var img = document.createElement("img")
                img.src = "images/bullet_hole.png"

                var x = event.clientX;     // Get the horizontal coordinate
                var y = event.clientY;     // Get the vertical coordinate
                if (hitMiss(event)) {
                    img.style.left = x - 25 - parseInt(target.style.left) + "px"
                    img.style.top = y - 25 - parseInt(target.style.top) + "px"
                    img.className = "hole"
                    var src = target
                    src.appendChild(img)

                }
                shot()
            }

            function hitMiss(event) {
                var x = event.clientX;     // Get the horizontal coordinate
                var y = event.clientY;     // Get the vertical coordinate
                if (y < parseInt(target.style.top) + target.offsetHeight &&
                        y > parseInt(target.style.top) && x > parseInt(target.style.left) && x < parseInt(target.style.left) + target.offsetWidth) {
                    numOfHitts++
                    var hitEl = document.getElementById("hit")
                    hitEl.innerHTML = numOfHitts
                    return true
                }
                else {
                    numOfMisses++
                    var missEl = document.getElementById("miss")
                    missEl.innerHTML = numOfMisses
                }
            }

           document.onmousemove=rotateGun
            function rotateGun(event){
                var x = event.clientX;     // Get the horizontal coordinate
                var y = event.clientY;// Get the vertical coordinate
                var newX=(browserWidth/2) -x
                var newY=(browserHeight)-y
                console.log("x:"+newX+"; y:"+newY)
                var rad=Math.atan2(newY,newX)
                var degrees = rad * (180/Math.PI)
                console.log(degrees-90)
                var gun = document.getElementById("gunImg")
                gun.style.transform = 'rotate('+(degrees-90)+'deg)';
                console.log(gun.style.transform)
            }

    //    })()//end of the clojure


    });//END DOCYMENT.READY

</script>
<!-- Built with love using Web Starter Kit -->
</body>
</html>
