<!doctype html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>


    <link rel="stylesheet" type="text/css" href="./styles/main.css">


    <title>JsShooter</title>


</head>
<body>
<input id="photo" type="file">
<button id="changePhoto" style=" float: right"> changePhoto</button>
<div id="canvas" style="height: 100%">
    <div id="info"></div>
    <img id="cross" src="images/cross.png">

    <div id="target">
        <img id="targetImg" src="images/simple_target.png">

    </div>
    <img src="images/bullet_hole.png">

    <div id="box">
        myBox`
    </div>

    <div id="gun" style="margin-left: 45%;
    margin-top: 15%"><img src="./images/gun.png"></div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        (function(){


        var target = document.getElementById('target')
        target.style.top = "0"
        target.style.left = "0"

        var targetVerticalSpeed = 5
        var targetHorizontalSpeed = 5
        var move = false
        var timeout
        var browserWidth = window.innerWidth
        var browserHeight = window.innerHeight

        function moveTarget(event) {
            if (move) {
                targetCollision()
                target.style.top = (parseInt(target.style.top) + targetVerticalSpeed) + "px"
                target.style.left = (parseInt(target.style.left) + targetHorizontalSpeed) + "px"
                timeout = setTimeout(moveTarget, 33);
            }
        }

        function targetCollision() {
            //vertical collision
            if (parseInt(target.style.top) + target.offsetHeight > browserHeight || parseInt(target.style.top) < 0)
                targetVerticalSpeed = -targetVerticalSpeed
            //horizontal collision
            if (parseInt(target.style.left) + target.offsetWidth > browserWidth || parseInt(target.style.left) < 0)
                targetHorizontalSpeed = -targetHorizontalSpeed
        }

        document.addEventListener("keydown",stopStartTarget)
        function stopStartTarget(event) {
            if (event.keyCode == 80 && move == false) {
                move = true
                moveTarget()
            }
            else {
                move = false
                clearInterval(timeout)
            }
        }



        var changePhotoButton = document.getElementById('changePhoto')
        changePhotoButton.addEventListener("click", changePhoto)
        function changePhoto() {
            var targetImage = document.getElementById('targetImg')
            var photo = document.getElementById("photo")
            var photoName = photo.value
            var photoSliced = photoName.slice(12)
            targetImage.src = photoSliced
        }

        function shot() {
            var gun = document.getElementById("gun")
            gun.style.marginTop = parseInt(gun.style.marginTop) - 2 + "%"
            setTimeout(function () {
                gun.style.marginTop = parseInt(gun.style.marginTop) + 2 + "%"
            }, 100);
        }

        var target = document.getElementById('target')
        target.addEventListener("click", hit)

        function hit(event) {
            var img = document.createElement("img")
            img.src = "images/bullet_hole.png"

            var x = event.clientX;     // Get the horizontal coordinate
            var y = event.clientY;     // Get the vertical coordinate

            img.style.left = x - 25 - parseInt(target.style.left) + "px"
            img.style.top = y - 25 - parseInt(target.style.top) + "px"
            img.className = "hole"
            var src = target
            src.appendChild(img)
            var audio = new Audio('./sounds/gun-gunshot-01.mp3')
            audio.play();
            shot()
        }
        })()//end of clojure


    });//END DOCYMENT.READY

</script>
<!-- Built with love using Web Starter Kit -->
</body>
</html>
